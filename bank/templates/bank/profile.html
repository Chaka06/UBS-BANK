{% extends 'bank/base.html' %}
{% load i18n %}

{% block content %}
<section class="mobile-screen">
    <div class="page-header">
        <h2>{% trans "Profil" %}</h2>
    </div>
    <div class="card-mobile">
        <div class="profile-row">
            <span class="muted">{% trans "Nom" %}</span>
            <strong>{{ user.last_name }}</strong>
        </div>
        <div class="profile-row">
            <span class="muted">{% trans "Prénom" %}</span>
            <strong>{{ user.first_name }}</strong>
        </div>
        <div class="profile-row">
            <span class="muted">{% trans "Email" %}</span>
            <strong>{{ user.email }}</strong>
        </div>
        <div class="profile-row">
            <span class="muted">{% trans "Téléphone" %}</span>
            <strong>{{ user.phone_number }}</strong>
        </div>
        <div class="profile-row">
            <span class="muted">{% trans "Adresse" %}</span>
            <strong>{{ user.address }}</strong>
        </div>
        <div class="profile-row">
            <span class="muted">{% trans "Pays" %}</span>
            <strong>{{ user.get_country_display }}</strong>
        </div>
        <p class="muted">{% trans "Les informations personnelles ne peuvent pas être modifiées." %}</p>
    </div>

    <div class="card-mobile">
        <h3>{% trans "Gestionnaire" %}</h3>
        {% if bank_account and bank_account.manager %}
            <div class="profile-row">
                <span class="muted">{% trans "Nom" %}</span>
                <strong>{{ bank_account.manager.full_name }}</strong>
            </div>
            <div class="profile-row">
                <span class="muted">{% trans "Email" %}</span>
                <strong>{{ bank_account.manager.email }}</strong>
            </div>
            <div class="profile-row">
                <span class="muted">{% trans "Appel téléphonique" %}</span>
                <strong>{{ bank_account.manager.phone_number|default:"-" }}</strong>
            </div>
            <div class="contact-actions">
                {% if bank_account.manager.phone_number %}
                    <a class="btn btn-outline" href="tel:{{ bank_account.manager.phone_number }}">
                        <i class="bx bxs-phone-call"></i>
                        {% trans "Appel" %}
                    </a>
                    <a class="btn btn-whatsapp" href="https://wa.me/{{ bank_account.manager.phone_number|cut:' ' }}">
                        <i class="bx bxl-whatsapp"></i>
                        {% trans "WhatsApp" %}
                    </a>
                {% endif %}
                <a class="btn btn-outline" href="mailto:{{ bank_account.manager.email }}">
                    <i class="bx bxs-envelope"></i>
                    {% trans "Email" %}
                </a>
            </div>
        {% else %}
            <p class="muted">{% trans "Votre gestionnaire n'est pas encore assigné." %}</p>
        {% endif %}
    </div>

    <div class="card-mobile">
        <h3>{% trans "Changer le mot de passe" %}</h3>
        <form method="post" class="form-grid">
            {% csrf_token %}
            {{ form.non_field_errors }}
            {% for field in form %}
                <div class="form-field">
                    {{ field.label_tag }}
                    {% if field.field.widget.input_type == "password" %}
                        <div class="password-field">
                            {{ field }}
                            <button type="button"
                                    class="toggle-password"
                                    aria-label="{% trans 'Afficher le mot de passe' %}"
                                    data-label-show="{% trans 'Afficher le mot de passe' %}"
                                    data-label-hide="{% trans 'Masquer le mot de passe' %}">
                                <span class="icon-show">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M12 5C6.5 5 2.1 8.4 1 12c1.1 3.6 5.5 7 11 7s9.9-3.4 11-7c-1.1-3.6-5.5-7-11-7Zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8Z"/>
                                    </svg>
                                </span>
                                <span class="icon-hide">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M3 5.3 4.3 4 20 19.7 18.7 21l-3-3A11.7 11.7 0 0 1 12 19C6.5 19 2.1 15.6 1 12c.5-1.7 1.7-3.4 3.3-4.8L3 5.3Zm6.6 6.6a2.5 2.5 0 0 0 3.4 3.4l-3.4-3.4Zm3.4-4.8A4 4 0 0 1 17 12a4 4 0 0 1-.3 1.6l-2-2a2 2 0 0 0-2.6-2.6l-2-2A4 4 0 0 1 13 7Z"/>
                                    </svg>
                                </span>
                            </button>
                        </div>
                    {% else %}
                        {{ field }}
                    {% endif %}
                    {% for error in field.errors %}
                        <span class="error">{{ error }}</span>
                    {% endfor %}
                </div>
            {% endfor %}
            <button class="btn btn-primary" type="submit">{% trans "Recevoir le code OTP" %}</button>
        </form>
    </div>
</section>
{% endblock %}
